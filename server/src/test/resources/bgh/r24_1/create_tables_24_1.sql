CREATE TABLE ACC_CBCF_OCC (
	REMARK VARCHAR2(128) NOT NULL,
	COD_TIPO_OCC NUMBER(1) NOT NULL
)
/

INSERT INTO ACC_CBCF_OCC VALUES ('Multa Rescisão contratual' ,3);
INSERT INTO ACC_CBCF_OCC VALUES ('Multa Contratual' ,3);
INSERT INTO ACC_CBCF_OCC VALUES ('Parcelamento Aparelho/TIM Chip' ,3);
INSERT INTO ACC_CBCF_OCC VALUES ('Multa Contratual: Rescisão Promo Troca de Aparelho' ,3);
-- this one is to simulate a OCC not to be handled by this rule
INSERT INTO ACC_CBCF_OCC VALUES ('Multa Contratual: Rescisão' ,2);


-- FIDELIZACAO NORMAL

--CREATE TABLE ACC_CBCF_FIDELIZACAO (
--	COD_FIDELIZACAO NUMBER(19)	NOT NULL,
--	CUSTOMER_ID	NUMBER(19)	NOT NULL
--)
--/

--INSERT INTO ACC_CBCF_FIDELIZACAO VALUES (1, 3818890);
--INSERT INTO ACC_CBCF_FIDELIZACAO VALUES (4, 7402934);
--INSERT INTO ACC_CBCF_FIDELIZACAO VALUES (5, 7406856);
--INSERT INTO ACC_CBCF_FIDELIZACAO VALUES (6, 1812868);
--INSERT INTO ACC_CBCF_FIDELIZACAO VALUES (9838, 8028604);



--CREATE TABLE ACC_CBCF_FIDELIZACAO_VERSAO (
--	COD_FIDELIZACAO NUMBER(19)	NOT NULL,
--	COD_STATUS	NUMBER(1) NOT NULL,
--	USERNAME VARCHAR2(64) NOT NULL
--)
--/

--INSERT INTO ACC_CBCF_FIDELIZACAO_VERSAO VALUES (1, 3, 'CBCF_QUE');
--INSERT INTO ACC_CBCF_FIDELIZACAO_VERSAO VALUES (4, 3, 'CBCF_QUE');
--INSERT INTO ACC_CBCF_FIDELIZACAO_VERSAO VALUES (5, 3, 'CBCF_QUE');
--INSERT INTO ACC_CBCF_FIDELIZACAO_VERSAO VALUES (6, 3, 'CBCF_QUE');
--INSERT INTO ACC_CBCF_FIDELIZACAO_VERSAO VALUES (9838, 3, 'CBCF_QUE');


CREATE TABLE ACC_CBCF_FIDELIZACAO_OCC_HIST (
	COD_FIDELIZACAO NUMBER(19)	NOT NULL,
	DAT_ENVIO_BSCS	DATE		NOT NULL,
	VLR_PRO_RATA	NUMBER(19,4) NOT NULL,
	NUM_PARCELAS_TOTAL INTEGER DEFAULT 1 NOT NULL,
    FEE_SEQNO       CHAR(1)
)
/

INSERT INTO ACC_CBCF_FIDELIZACAO_OCC_HIST VALUES (15985481, TO_DATE('08/02/08', 'DD/MM/YY'), 135, 1, '1');
INSERT INTO ACC_CBCF_FIDELIZACAO_OCC_HIST VALUES (4, TO_DATE('08/02/08', 'DD/MM/YY'), 55.33, 1, '1');
INSERT INTO ACC_CBCF_FIDELIZACAO_OCC_HIST VALUES (5, TO_DATE('08/01/08', 'DD/MM/YY'), 10, 1, '1');
INSERT INTO ACC_CBCF_FIDELIZACAO_OCC_HIST VALUES (6, TO_DATE('15/04/08', 'DD/MM/YY'), 11.95, 3, '1');
INSERT INTO ACC_CBCF_FIDELIZACAO_OCC_HIST VALUES (9838, TO_DATE('29/06/07', 'DD/MM/YY'), 480, 1, '1');

ALTER TABLE ACC_CBCF_FIDELIZACAO_OCC_HIST ADD COD_TIPO_OCC NUMBER DEFAULT 3 NOT NULL;

-- CONTA FIXA

CREATE TABLE ACC_CBCF_FIDELIZACAO_HIST_CF (
	COD_FIDELIZACAO NUMBER(19)	NOT NULL,
	CUSTOMER_ID	NUMBER(19)	    NOT NULL,
    COD_STATUS	NUMBER(1)       NOT NULL
)
/

INSERT INTO ACC_CBCF_FIDELIZACAO_HIST_CF VALUES( 101, 38188900, 3 );
INSERT INTO ACC_CBCF_FIDELIZACAO_HIST_CF VALUES( 104, 74029340, 3 );
INSERT INTO ACC_CBCF_FIDELIZACAO_HIST_CF VALUES (105, 74068565, 3 );

ALTER TABLE ACC_CBCF_FIDELIZACAO_HIST_CF ADD COD_MOTIVO_FINALIZACAO NUMBER DEFAULT 16 NOT NULL;

CREATE TABLE ACC_CBCF_FIDELIZ_OCC_HIST_CF (
	COD_FIDELIZACAO NUMBER(19)	NOT NULL,
	VLR_PRO_RATA  NUMBER(19,4)  NOT NULL,
	NUM_PARCELAS_TOTAL INTEGER DEFAULT 1 NOT NULL,
	DAT_ENVIO_BSCS		DATE    NOT NULL
)
/

INSERT INTO ACC_CBCF_FIDELIZ_OCC_HIST_CF VALUES (101, 135, 1, TO_DATE('08/02/08', 'DD/MM/YY'));
INSERT INTO ACC_CBCF_FIDELIZ_OCC_HIST_CF VALUES (104, 55.33, 1, TO_DATE('08/02/08', 'DD/MM/YY'));
INSERT INTO ACC_CBCF_FIDELIZ_OCC_HIST_CF VALUES (105, 10, 1, TO_DATE('08/01/08', 'DD/MM/YY'));

ALTER TABLE ACC_CBCF_FIDELIZ_OCC_HIST_CF ADD FEE_SEQNO CHAR(1) DEFAULT '1' NOT NULL;


CREATE TABLE ACC_CBCF_FIDELIZACAO_HIST (
    COD_FIDELIZACAO	      NUMBER		NOT NULL,
    FID_SEQNO	          NUMBER		NOT NULL,
    COD_PROMOCAO	      NUMBER		NOT NULL,
    CUSTOMER_ID	          NUMBER		NOT NULL,
    COST_ID	              NUMBER		NOT NULL,
    CO_ID	              NUMBER		NOT NULL,
    COD_APARELHO	      NUMBER	            ,
    NUM_NOTA_FISCAL	      VARCHAR2(100)	        ,
    TIP_BENEFICIO	      VARCHAR2(1)	        ,
    QTD_MESES	          NUMBER		NOT NULL,
    QTD_MESES_FIDELIZADO  NUMBER	            ,
    DAT_CRIACAO	          DATE		    NOT NULL,
    DAT_EXPIRACAO	      DATE		    NOT NULL,
    DAT_FINALIZACAO	      DATE		    NOT NULL,
    COD_MOTIVO_FINALIZACAO	  NUMBER	NOT NULL,
    DSC_OBSERVACAO	      VARCHAR2(500)	        ,
    COD_STATUS	          NUMBER		NOT NULL,
    USERNAME	          VARCHAR2(16)	NOT NULL,
    COD_ELEGIBILIDADE_INICIAL NUMBER	NOT NULL,
    COD_ELEGIBILIDADE_FINAL	  NUMBER	        ,
    VLR_DESCONTO	      NUMBER	            ,
    VLR_FIDELIZACAO	      NUMBER		NOT NULL,
    CO_ID_LA	          NUMBER	            ,
    NUM_SERIE_NOTA_FISCAL VARCHAR2(100)	        ,
    NUM_ORDEM_VENDA	      VARCHAR2(100)	        ,
    USERNAME_CRIACAO	  VARCHAR2(16)	        ,
    DAT_INSERCAO	      DATE	 DEFAULT SYSDATE
);

INSERT INTO ACC_CBCF_FIDELIZACAO_HIST VALUES (4608058,	1,	1,	3818890,	16,	4582223, null, null, null, 12,	18, to_date('17/10/2005 16:31', 'DD/MM/YYYY HH24:MI'), to_date('17/10/2006 16:31', 'DD/MM/YYYY HH24:MI'), 	to_date('20/04/2007  02:16', 'DD/MM/YYYY HH24:MI'),  1, null,                                      2,	'CBCF_FIN', 336765, 336765, null, 348,    0, null, null, null, to_date('23/4/2008 02:18', 'DD/MM/YYYY HH24:MI') );
INSERT INTO ACC_CBCF_FIDELIZACAO_HIST VALUES (4169146,	1,	1,	3818890,	16,	4582505, null, null, null, 12,	18, to_date('17/10/2005 16:47', 'DD/MM/YYYY HH24:MI'), to_date('17/10/2006 16:47', 'DD/MM/YYYY HH24:MI'), 	to_date('18/04/2007  09:14', 'DD/MM/YYYY HH24:MI'),  1, null,                                      2,	'CBCF_FIN', 336768, 336768, null, 348,    0, null, null, null, to_date('23/4/2008 02:18', 'DD/MM/YYYY HH24:MI') );
INSERT INTO ACC_CBCF_FIDELIZACAO_HIST VALUES (15985481,	1,	34,	3818890,	16,	4582223, null, null,  'D', 10,	 1, to_date('19/01/2008 00:00', 'DD/MM/YYYY HH24:MI'), to_date('19/11/2008 00:00', 'DD/MM/YYYY HH24:MI'), 	to_date('03/02/2008  13:19', 'DD/MM/YYYY HH24:MI'), 16, null,                                      4,	'F8022283', 336993, 336993,  150, 150, null, null, null, null, to_date('23/4/2008 02:18', 'DD/MM/YYYY HH24:MI') );
INSERT INTO ACC_CBCF_FIDELIZACAO_HIST VALUES (8969271,	2,	1,	7692267,	12,	8539560, null, null, null, 12,	12, to_date('07/02/2007 00:00', 'DD/MM/YYYY HH24:MI'), to_date('07/02/2008 00:00', 'DD/MM/YYYY HH24:MI'), 	to_date('07/02/2008  01:25', 'DD/MM/YYYY HH24:MI'),  1, null,                                      2,	'CBCF_FIN', 253882, 253889, null, 348, null, null, null, null, to_date('23/4/2008 02:18', 'DD/MM/YYYY HH24:MI') );
INSERT INTO ACC_CBCF_FIDELIZACAO_HIST VALUES (8969874,	1,	1,	7693166,	13,	8541319, null, null, null, 12,	11, to_date('07/02/2007 00:00', 'DD/MM/YYYY HH24:MI'), to_date('07/02/2008 00:00', 'DD/MM/YYYY HH24:MI'), 	to_date('19/01/2008  11:31', 'DD/MM/YYYY HH24:MI'), 10, 'Cliente está refidelizada por 12 meses',  4,	'F8025810',      7,      7, null, 348, null, null, null, null, to_date('23/4/2008 02:18', 'DD/MM/YYYY HH24:MI') );
INSERT INTO ACC_CBCF_FIDELIZACAO_HIST VALUES (      4,  1,  1,  7402934,    16, 8209216, null, null, null, 12,	11, to_date('07/02/2007 00:00', 'DD/MM/YYYY HH24:MI'), to_date('07/02/2008 00:00', 'DD/MM/YYYY HH24:MI'), 	to_date('19/01/2008  11:31', 'DD/MM/YYYY HH24:MI'), 10, null,                                      4,   'F8025810',      7,      7, null, 348, null, null, null, null, to_date('23/4/2008 02:18', 'DD/MM/YYYY HH24:MI') );
INSERT INTO ACC_CBCF_FIDELIZACAO_HIST VALUES (      6,  1,  1,  1812868,    16, 2267031, null, null, null, 12,	11, to_date('07/02/2007 00:00', 'DD/MM/YYYY HH24:MI'), to_date('07/02/2008 00:00', 'DD/MM/YYYY HH24:MI'), 	to_date('19/01/2008  11:31', 'DD/MM/YYYY HH24:MI'), 10, null,                                      4,   'F8025810',      7,      7, null, 348, null, null, null, null, to_date('23/4/2008 02:18', 'DD/MM/YYYY HH24:MI') );
INSERT INTO ACC_CBCF_FIDELIZACAO_HIST VALUES (   9838,  1,  1,  8028604,    16,52070231, null, null, null, 12,	11, to_date('07/02/2007 00:00', 'DD/MM/YYYY HH24:MI'), to_date('07/02/2008 00:00', 'DD/MM/YYYY HH24:MI'), 	to_date('19/01/2008  11:31', 'DD/MM/YYYY HH24:MI'), 10, null,                                      4,   'F8025810',      7,      7, null, 348, null, null, null, null, to_date('23/4/2008 02:18', 'DD/MM/YYYY HH24:MI') );


CREATE TABLE ACC_CBCF_MOTIVO_FINALIZACAO (
    COD_MOTIVO_FINALIZACAO	  NUMBER	          NOT NULL,
    DSC_MOTIVO_FINALIZACAO	  VARCHAR2(255)	      NOT NULL,
    COD_PROMOCAO	          NUMBER	                  ,
    COD_CATEGORIA	          NUMBER	                  ,
    TIP_MOTIVO	              NUMBER
);

INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (1	  ,'Término da fidelização', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (2	  ,'Quebra por downgrade dentro da promoção', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (3	  ,'Quebra por downgrade fora da promoção', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (4	  ,'Quebra por upgrade dentro da promoção', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (5	  ,'Quebra por upgrade fora da promoção', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (6	  ,'Quebra por desativação do contrato', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (7	  ,'Quebra por suspensão do contrato', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (8	  ,'Transferência de titularidade', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (9	  ,'Transferência de fidelização', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (10	,'Acordo com o cliente', null, null,2);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (11	,'Ordem judicial', null, null,2);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (12	,'Acordo com o cliente', null, null,3);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (13	,'Outros erros fideliz. Exceto de Aparelho/Chip', null, null,3);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (14	,'Ordem judicial', null, null,3);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (15	,'UDI - Oferta Retenção e Fidelização Bonus', null, 3,	3);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (16	,'Quebra de Fidelidade', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (18	,'Quebra por Migração Pós -> Conta Fixa, sem transferência de fidelização para o CBCF CF', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (19	,'Quebra por Migração Pós -> Conta Fixa, seguido de transferência de fidelização para o CBCF CF', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (20	,'Quebra por Migração Conta Fixa -> Pós, sem transferência de fidelização para o CBCF Pós', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (21	,'Quebra por Migração Conta Fixa -> Pós, seguido de transferência de fidelização para o CBCF Pós', null, null,1);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (22	,'Negociação de Retenção', null, null,5);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (23	,'Negociação de Retenção', null, null,6);
INSERT INTO ACC_CBCF_MOTIVO_FINALIZACAO VALUES (24	,'Erro de fidelização de Aparelho e/ou chip', null, null,3);
